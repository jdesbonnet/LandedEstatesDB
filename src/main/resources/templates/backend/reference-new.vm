$breadcrumbs.add("Estates","estate-list.jsp").add($estate.name,"estate-show.jsp?id=${estate.id}").add("Add reference")

<script src="${TYPEAHEAD_SCRIPT}"></script>

<form action="reference-new-submit.jsp" method="POST">

<input type="hidden" name="estate_id" value="${estate.id}" />

<div class="form-group">
    <label for="field_description">Reference description</label>
    <textarea id="field_description" name="description" class="form-control"
    rows="5" cols="60" wrap="virtual"></textarea>
</div>

<div class="form-group">
    <label for="refsource">Reference source:</label>
    <input id="refsource" class="form-control typeahead" type="text" size="80" />
    <input type="hidden" name="refsource_id" />
</div>

<div class="form-group">
<button type="submit" class="btn btn-primary" name="_submit_continue">Save and continue to add references</button>
<button type="submit" class="btn btn-primary" name="_submit_exit">Save and return to estate record</button>
</div>

</form>

<script>

jQuery(function(){
	jQuery('#refsource').typeahead(null,
	{
		afterSelect: function(val) {
			alert(val);
			console.log("val="+val);
			this.$element.val(""); 
		},
		display: 'name',
		source: function(query,process) {
			console.log("process="+process);
			// TODO: async false is deprecated
			var result = null;
			jQuery.ajax({
				url: "query-refsource.async.jsp?q="+query,
				type: "get",
				dataType: "html",
				async: false,
				success: function(data) {
					result = data;
				} 
			});
			console.log(result);
			console.log(JSON.parse(result));
			process(JSON.parse(result));
		}
	});
	jQuery("#refsource").bind('typeahead:select', function(ev, suggestion) {	
		jQuery("input[name='refsource_id']").val(suggestion.id);
	});
});

</script>

